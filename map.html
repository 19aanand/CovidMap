<!DOCTYPE html>
<html>
<head>
  <title>COVID 19 Map</title>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.4.js"></script>
  <script type="text/javascript" src="https://maps.google.com/maps/api/js?libraries=places&region=uk&language=en&key=AIzaSyDRVlOny0TLwFDTYkHhKBKMdW8iJXLLpmg"></script>
  <script type="text/javascript">
    function initialize() {

      var content = document.getElementById('iw');

      var lat = -18.475,
        lng = -70.31444,
        latlng = new google.maps.LatLng(lat, lng);

      var mapOptions = {
        center: new google.maps.LatLng(lat, lng),
        zoom: 3,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };

      var mapCanvas = document.getElementById('map');

      var map = new google.maps.Map(mapCanvas, mapOptions);
      for (var i = 0; i < locations.length; i++) {
        gmarkers[locations[i].name] =
          createMarker(
            new google.maps.LatLng(locations[i].location.lat, locations[i].location.lon),
            locations[i].name + "<br>" +
            locations[i].adress,
            locations[i].lable
          );
        var infowindow = new google.maps.InfoWindow({
          maxWidth: 350
        });
      }
      function createMarker(latlng, html, lable) {
        console.log(lable);
        var marker = new google.maps.Marker({
          position: latlng,
          map: map,
          icon: {

            scaledSize: new google.maps.Size(5, 5),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20),
            labelOrigin: new google.maps.Point(22, 18),
          },
          label: {
            text: lable,
            color: "#fff",
          }
        });
        marker.setOpacity(.75);
        google.maps.event.addListener(marker, 'click', function() {
          infowindow.setContent(html);
          infowindow.open(map, marker);
        });
        google.maps.event.addListener(map, 'click', function() {
          infowindow.close();
        });
        return marker;
      }
    }
    function myclick(i) {
      google.maps.event.trigger(gmarkers[i], 'click');
    };

    google.maps.event.addDomListener(window, 'load', initialize);
    $('a').on('click', function(e) {
      e.preventDefault();
      var $this = $(this),
        loc = $this.data('location');
      // ----- Var 2 Wit wrap initialize function
      myclick(loc);
    });
    $('a').hover(
      function() {
        var $this = $(this),
          loc = $this.data('location');
        gmarkers[loc].setOpacity(1.0);
        gmarkers[loc].setIcon({
          url: 'data:image/svg+xml;charset=utf-8,' +
            encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24"><path fill="red" d="M12 0c-4.198 0-8 3.403-8 7.602 0 4.198 3.469 9.21 8 16.398 4.531-7.188 8-12.2 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"/></svg>'),
          scaledSize: new google.maps.Size(44, 44),
          origin: new google.maps.Point(0, 0),
          anchor: new google.maps.Point(44, 44),
          labelOrigin: new google.maps.Point(22, 18),
        })
      },
      function() {
        var $this = $(this),
          loc = $this.data('location');
        gmarkers[loc].setOpacity(.75);
        gmarkers[loc].setIcon({
          url: 'data:image/svg+xml;charset=utf-8,' +
            encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24"><path d="M12 0c-4.198 0-8 3.403-8 7.602 0 4.198 3.469 9.21 8 16.398 4.531-7.188 8-12.2 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"/></svg>'),
          scaledSize: new google.maps.Size(44, 44),
          origin: new google.maps.Point(0, 0),
          anchor: new google.maps.Point(44, 44),
          labelOrigin: new google.maps.Point(22, 18),
        });
      }
    );

    gmarkers = [];

    var locations = [];

    // https://stackoverflow.com/questions/33155999/converting-a-csv-file-into-a-2d-array
    function csvToArray (csv) {
        rows = csv.split("\n");
        console.log(rows.length)
        for (var i = 0; i < rows.length; i++) {
          row = rows[i].split(",")
          var l = 
            {
              'name': 'Tasa: ' + row[13],
              'adress': row[2] + '' + row[3] + row[4] + '' + row[5],
              'location': {
                'lat': row[0],
                'lon': row[1]
              },
              'lable': row[13],
            }
            locations.push(l);
        }
    };

    $.ajax({
        url: "Covid-19-geo.csv",
        async: false,
        success: function (csvd) {
          csvToArray(csvd)
        },
        dataType: "text",
        complete: function () {
            // call a function on complete 
        }
    });
  </script>

  <style type="text/css">
    body, html {
      height: 100%;
      width: 100%;
      margin: 0px;
      padding: 0px
    }
    #map {
      height: 100%;
      width: 100%;
      margin: 0px;
      padding: 0px
    }
  </style>

</head>
  <body>
    <div id="map"></div>
  </body>
</html>